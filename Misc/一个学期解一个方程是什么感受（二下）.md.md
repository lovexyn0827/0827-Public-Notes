# NEXT

## 经验与教训

尽管在上面的尝试中，我们并没有得到原方程组的解，但是，这些尝试确实向我们提供了一系列有用的思路与符号工具。

- 应可以通过联立原方程$\boldsymbol X=\boldsymbol{AX}+\boldsymbol G$与求解中得到的方程组$\boldsymbol{LX}=\boldsymbol F$求解；
- 可以参照原先处理非满秩系数矩阵的方法，构建迭代的算法将问题化归为可以求解的问题。
- 联立过程中，可以通过构建含有大量0的矩阵$\boldsymbol{PSL}+\boldsymbol A$作为新的系数矩阵，然后刨除含0的行列缩小问题规模；
- 使用诸如$\boldsymbol L\backslash  c_i$的记号表示矩阵去除指定行列后的结果；

所以，接下来，我们继续总结前边失败的原因，以此寻找新的求解方法。

我们注意到，我们前边求解的失败的原因多是找不到合适的$\boldsymbol{P}$，使得$\boldsymbol{PSL}$中出现有可用规律的（比如大小为$(n-m)\times(n-m)$的）全零分块，虽然根据我们的“直觉”，这么一个$\boldsymbol P$应该是存在的。

同时可知，导致我们失败的原因可归结为行与列的化归结果不匹配，而我们又没有机会通过在$(\boldsymbol{PSL}+\boldsymbol A)$右边乘上一个矩阵实现列变换来修正这一点。比如，我们曾期望使得$(\boldsymbol{PSL}+\boldsymbol A)$的右上角全为0，虽然我们可以通过行变换将$\boldsymbol{SL}$中的线性无关行集中到矩阵的上半部分（前$m$行），然后通过$\boldsymbol P$将这前$m$行的线性组合加到$\boldsymbol A$的各行中，相互抵消，使得其中出现$m$个全0的列，但是，对于将这些列通过列变换集中到一个分块当中我们却无能为力。

## Next Steps

### 对等性？

那么，如果确实不能拼凑出分块的话，我们可不可以借助一次操作，至少使得行列之间能够对等呢？

当然可以。我们有秩为$m$的方阵$\boldsymbol{L}$，那么可以从其中抽取出$m$个线性无关的行，然后将这些行拼凑成一个新的矩阵$\boldsymbol{L}_m$，这些行的序号组成集合$R$。显然，因为$\boldsymbol{L}_m$的各行均线性无关，$r(\boldsymbol{L}_m)=m$，考虑到行秩等于列秩，我们可以从其中继续抽取出$m$个线性无关的列，其序号组成集合$N$（non-zero），其它各列序号组成集合$Z$（zero）。这些列其实组成了一个大小为$m\times m$的满秩矩阵，其中也是$\boldsymbol{L}$的一个秩最大的余子式。虽然直接处理$\boldsymbol L$时，集合$R$不一定等于$N$，即行与列依然不对等，但我们可以通过对$\boldsymbol{L}$先进行简单的行位置交换（以$\boldsymbol{S}$描述），使得我们刚刚选中的$m$个线性无关行集中到集合$N$对应的行位置当中。换句话说，我们使得序号在集合$N$里边的行和列都能够组成秩为$m$的矩阵，从某种层面来讲，这样我们便实现了变换后矩阵$\boldsymbol{SL}$行列的对等。

> 为避免混淆，本文中$N$、$Z$均表示上文所定义的集合，而专用符号$\N$，$\Z$表示自然数集和整数集

### 离散的分块

#### 集合下标与分类聚合

接下来，我们可以取$\boldsymbol{SL}$中行号列号均在$N$中的元素，在不调换元素在矩阵中的位置关系的前提下组成的矩阵为$(\boldsymbol{SL})_{NN}$，这也就是我们刚才提到的那个$m\times m$的满秩矩阵。类似地，取行号在$N$中但列号在$Z$中的元素组成的的矩阵为$(\boldsymbol{SL})_{NZ}$，取列号在$N$中但行号在$Z$中的的元素组成的矩阵为$(\boldsymbol{SL})_{ZN}$，取行号列号均在$Z$中的元素组成的的矩阵为$(\boldsymbol{SL})_{ZZ}$。下面类似的记号的含义均相同。

> 出于严谨性，我们给出$(\boldsymbol{SL})_{ZN}$的更严格定义，其它各记号类似给出：
>
> $(\boldsymbol{SL})_{ZN}=((\boldsymbol{SL})_{p_iq_j})\in \C^{|Z|\times |N|}$，其中$p_i\in Z$且$q_j\in N$，且$1\le i< |Z|$时$p_i<p_{i+1}$，且$1\le j<|N|$时$q_{j}<q_{j+1}$
>
> 由此可知，我们实际上是仿照$\boldsymbol M_{ij}$一类用原矩阵 + 整数下标表示元素的符号系统，定义了用原矩阵 + 集合下标表示子式的符号。

紧接着，自然地，我们记$\boldsymbol{X}_N$、$\boldsymbol{X}_Z$分别为大小为$n\times 1$的列向量$\boldsymbol{X}$中，序号在集合$N$、$Z$中的元素，在不调换元素顺序的前提下组成的行向量（也可此定义中$n\times1$列向量推广任意的$n\times k$矩阵，其中$k$为任意正整数）。

> 这里实际上是仿照$\boldsymbol M_{i}$一类用原矩阵 + 整数下标表示行向量的符号，定义了用原矩阵 + 集合下标表示子式的符号。

这样做有什么用呢？

对$\boldsymbol{SL}$施加前边所通常采取的将线性无关行的线性组合（用$\boldsymbol{P}$表示）加到$\boldsymbol A$的各行中的变换，可得矩阵$(\boldsymbol{PSL} + \boldsymbol A)$。其中，因为$(\boldsymbol{SL})_{NN}$是满秩的，我们可以用其中的行来线性表出由$\boldsymbol {SL}$中序号在$N$中的各列依次组成的$n\times m$矩阵$(((\boldsymbol{SL})^T)_{N})^T$中的每一行，通过使当的行变换$\boldsymbol{P}$我们可以通过抵消“清除”$(\boldsymbol{PSL}+\boldsymbol{A})_{N}$中的内容，即使得
$$
(\boldsymbol{PSL}+\boldsymbol A)_{NN}=\boldsymbol{O}
$$
$$
(\boldsymbol{PSL}+\boldsymbol A)_{ZN}=\boldsymbol{O}
$$

> 或者（非正式地），我们也可这样表示：
> $$
> (\boldsymbol{PSL}+\boldsymbol A)_{\cdot N}=\boldsymbol{O}
> $$

这样，在某种意义上，我们获得了一个全零的“分块”。尽管这一分块中元素在整个矩阵$(\boldsymbol{PSL}+\boldsymbol A)$中出现的位置是离散的。

#### 重组整合

我们由已进行的求解已经知道：
$$
\boldsymbol{LX}=\boldsymbol{F}
$$
从而
$$
\boldsymbol{PSLX}-\boldsymbol{PSF}=\boldsymbol O
$$
但是，因为我们上面对矩阵元素的进行的按行或列的序号是否属于$N$所进行的“分类聚合”并不是正常意义上的矩阵分块，不能用分块矩阵的形式直接将上述矩阵用我们所谓的诸如“$(\boldsymbol{PSL}+\boldsymbol A)_{N}$”等直接表出。

于是，我们先引入将上述分类聚合”后的矩阵按行或按列整合成原矩阵的运算：
$$
\operatorname{ComposeR}\begin{pmatrix}\boldsymbol{M}_{Z\cdot}\\\boldsymbol{M}_{N\cdot}\end{pmatrix}
=\boldsymbol{M}_{\cdot}
$$

$$
\operatorname{ComposeC}((\boldsymbol{M}_{Z\cdot})^T,(M_{N\cdot})^T)=(\boldsymbol{M}_{\cdot})^T
$$

其中“$\cdot$”可写作$Z$、$N$，亦可留空。

我们首先考虑这些运算的存在性。$\operatorname{ComposeR}$的一个可行的操作是直观的：留出一个$n\times k$矩阵的空间，然后将$\boldsymbol{M}_{Z\cdot}$和$\boldsymbol{M}_{N\cdot}$的各行依照其在“分类聚合”前在原矩阵中的位置填入即可，即：
$$
\text{r th row of }\operatorname{ComposeR}\begin{pmatrix}\boldsymbol{M}_{Z\cdot}\\\boldsymbol{M}_{N\cdot}\end{pmatrix}
=\begin{cases}
s_r\text{ th row of}~\boldsymbol M_Z&\text{if}~r\in Z\\
t_r\text{ th row of}~\boldsymbol M_N&\text{if}~r\in N\\
\end{cases}
$$
其中$1\le r_1<r_2<n$时，若$r_1,r_2\in Z$，$s_{r_1}<s_{r_2}$；若$r_1,r_2\in N$，$t_{r_1}<t_{r_2}$。

我们将此作为$\operatorname{ComposeR}$的操作性定义。

因为我们有
$$
\operatorname{ComposeC}((\boldsymbol{M}_{Z\cdot})^T,(M_{N\cdot})^T)=(\boldsymbol M_{\cdot})^T=\left(\operatorname{ComposeR\begin{pmatrix}\boldsymbol{M}_{Z\cdot}\\\boldsymbol{M}_{N\cdot}\end{pmatrix}}\right)^T
$$
故$\operatorname{ComposeC}$也是存在的。

然后，既然我们有了按行整合和按列整合的运算，那么我们就可以对方阵$\boldsymbol M$定义将四个“分类聚合”得到的矩阵整合的运算：
$$
\operatorname{Compose}\begin{pmatrix}
\boldsymbol M_{ZZ}&\boldsymbol M_{ZN}\\
\boldsymbol M_{NZ}&\boldsymbol M_{NN}
\end{pmatrix}
=\operatorname{ComposeR}\begin{pmatrix}
\operatorname{ComposeC}(\boldsymbol M_{ZZ},\boldsymbol M_{ZN})\\
\operatorname{ComposeC}(\boldsymbol M_{NZ},\boldsymbol M_{NN})
\end{pmatrix}
$$
易证$\operatorname{Compose}\begin{pmatrix}
\boldsymbol M_{ZZ}&\boldsymbol M_{ZN}\\
\boldsymbol M_{NZ}&\boldsymbol M_{NN}
\end{pmatrix}=\boldsymbol M$。

我们证明重新整合的矩阵与分块矩阵（至少在需要的情形下）同样地满足矩阵乘法运算：
$$
\operatorname{Compose}\begin{pmatrix}
\boldsymbol M_{ZZ}&\boldsymbol M_{ZN}\\
\boldsymbol M_{NZ}&\boldsymbol M_{NN}
\end{pmatrix}\operatorname{ComposeR}
\begin{pmatrix}
\boldsymbol v_{Z}\\
\boldsymbol v_{N}
\end{pmatrix}
=\operatorname{ComposeR}
\begin{pmatrix}
\boldsymbol M_{ZZ}\boldsymbol v_Z+\boldsymbol M_{ZN}\boldsymbol v_N\\
\boldsymbol M_{NZ}\boldsymbol v_Z+\boldsymbol M_{NN}\boldsymbol v_N
\end{pmatrix}
$$
其中$\boldsymbol M$是$n\times n$方阵，$\boldsymbol v$为$n\times 1$的列向量。

不妨对乘法结果逐元素分析：
$$
\begin{eqnarray}
&&\left(
\operatorname{Compose}
\begin{pmatrix}
\boldsymbol M_{ZZ}&\boldsymbol M_{ZN}\\
\boldsymbol M_{NZ}&\boldsymbol M_{NN}
\end{pmatrix}
\operatorname{ComposeR}
\begin{pmatrix}
\boldsymbol v_{Z}\\
\boldsymbol v_{N}
\end{pmatrix}
\right)_{i}\\
&=&\sum_{s=1}^n\operatorname{ComposeR}\begin{pmatrix}
\operatorname{ComposeC}(\boldsymbol M_{ZZ},\boldsymbol M_{ZN})\\
\operatorname{ComposeC}(\boldsymbol M_{NZ},\boldsymbol M_{NN})
\end{pmatrix}_{is}
\operatorname{ComposeR}
\begin{pmatrix}
\boldsymbol v_{Z}\\
\boldsymbol v_{N}
\end{pmatrix}_{s}
\end{eqnarray}
$$
设$Z=\{k_1, \cdots, k_{n-m}\}$，$N=\{1,\cdots, n\}-Z=\{l_1,\cdots,l_m\}$，其中$k_1\le k_2\le \cdots\le k_{n-m}$，$l_1\le l_2\le\cdots\le l_m$，若$i\in Z$则有
$$
\begin{eqnarray}
&&\left(
\operatorname{Compose}
\begin{pmatrix}
\boldsymbol M_{ZZ}&\boldsymbol M_{ZN}\\
\boldsymbol M_{NZ}&\boldsymbol M_{NN}
\end{pmatrix}
\operatorname{ComposeR}
\begin{pmatrix}
\boldsymbol v_{Z}\\
\boldsymbol v_{N}
\end{pmatrix}
\right)_{i}\\
&=&\sum_{s=1}^n
\operatorname{ComposeC}(\boldsymbol M_{ZZ},\boldsymbol M_{ZN})_{is}
\operatorname{ComposeR}
\begin{pmatrix}
\boldsymbol v_{Z}\\
\boldsymbol v_{N}
\end{pmatrix}_{s}\\
&=&\sum_{s\in Z}
\operatorname{ComposeC}(\boldsymbol M_{ZZ},\boldsymbol M_{ZN})_{is}
\operatorname{ComposeR}
\begin{pmatrix}
\boldsymbol v_{Z}\\
\boldsymbol v_{N}
\end{pmatrix}_{s}\\
&&+\sum_{s\in N}
\operatorname{ComposeC}(\boldsymbol M_{ZZ},\boldsymbol M_{ZN})_{is}
\operatorname{ComposeR}
\begin{pmatrix}
\boldsymbol v_{Z}\\
\boldsymbol v_{N}
\end{pmatrix}_{s}\\
&=&\sum_{s=1}^{n-m}(\boldsymbol M_{ZZ})_{ik_s}(\boldsymbol v_Z)_{k_s}
+\sum_{s=1}^{m}(\boldsymbol M_{ZN})_{il_s}(\boldsymbol v_N)_{l_s}\\
&=&(\boldsymbol M_{ZZ}\boldsymbol v_Z)_{i}+(\boldsymbol M_{ZN}\boldsymbol v_N)_{i}\\
&=&(\boldsymbol M_{ZZ}\boldsymbol v_Z+\boldsymbol M_{ZN}\boldsymbol v_N)_{i}
\end{eqnarray}
$$
即$i\in Z$时，原式左右两侧对应行相等；$i\in N$时，亦类似可证，至此原命题得证。

同样可以证明：
$$
\operatorname{ComposeR}
\begin{pmatrix}
\boldsymbol X_{Z}\\
\boldsymbol X_{N}
\end{pmatrix}+\operatorname{ComposeR}
\begin{pmatrix}
\boldsymbol Y_{Z}\\
\boldsymbol Y_{N}
\end{pmatrix}=\operatorname{ComposeR}
\begin{pmatrix}
(\boldsymbol X+\boldsymbol Y)_{Z}\\
(\boldsymbol X+\boldsymbol Y)_{N}
\end{pmatrix}
$$
且对$\operatorname{ComposeC}$、$\operatorname{Compose}$均有类似的结论成立。

#### $\boldsymbol P$的存在性的构造式证明

因为在前面的多种思路中，我们都因细微的疏漏，错误地断言了$\boldsymbol P$的存在性，从而陷入了无效的推导当中，保险起见，在最后，我们以更严格的方式证明$\boldsymbol P$的存在性：

> 其实这段证明本来准备放在前面简单地分析$\boldsymbol P$的存在性的位置，但是，因为证明相对冗长，且$\boldsymbol P$的结构需要用$\operatorname{ComposeC}$运算才能简洁地表示，所以只能将其移动到此处。

首先，仿照$(\boldsymbol{SL})_{ZN}$，我们给出$(\boldsymbol{PSL}+\boldsymbol A)_{\cdot N}$的较严格定义：

$(\boldsymbol{PSL}+\boldsymbol A)_{\cdot N}=((\boldsymbol{PSL}+\boldsymbol A)_{iq_j})\in\C^{n\times |N|}$，其中$q_j\in N$且$1\le j < |N|$时$q_j<q_{j+1}$。

**引理1**：对任意$n\times n$复矩阵$\boldsymbol A$、$\boldsymbol B$，有$(\boldsymbol A+\boldsymbol B)_{\cdot N}=\boldsymbol A_{\cdot N}+\boldsymbol B_{\cdot N}$

> 如果$N$是传统的数字下标（提取出一个列）而不是集合（提取出一个子式），这是显然、且在一般的线性代数教材中几乎一定存在的结论；引理2亦然。

首先借用前面定义中的符号$q_j$，从原式更复杂一端入手，逐元素分析。
$$
(\boldsymbol A_{\cdot N})_{ij}+(\boldsymbol B_{\cdot N})_{ij}
=\boldsymbol A_{iq_j}+\boldsymbol B_{iq_j}=(\boldsymbol A+\boldsymbol B)_{iq_j}
=((\boldsymbol A+\boldsymbol B)_{\cdot N})_{ij}
$$
两矩阵对应元素相等，原命题得证。

**引理2**：对任意$n\times n$复矩阵$\boldsymbol A$、$\boldsymbol B$，有$(\boldsymbol{AB})_{\cdot N}=\boldsymbol A(\boldsymbol B_{\cdot N})$

依然逐元素分析

> 虽然这里“更复杂一端”是那一边没有引理1明显（尽管那里待证等式两端形式上复杂度也不相上下），但从直觉上，我们仍感觉从右端切入似乎更合理，因为这里与引理1一样，是先取下标，再做常规运算的表达式。

$$
(\boldsymbol A(\boldsymbol B_{\cdot N}))_{ij}
=\sum_{s=1}^n\boldsymbol A_{is}((\boldsymbol B)_{\cdot N})_{sj}
=\sum_{s=1}^n\boldsymbol A_{is}\boldsymbol B_{sq_j}
=(\boldsymbol{AB})_{iq_j}
=(\boldsymbol{AB})_{\cdot N}
$$

**引理3**：对任意$n\times n$复矩阵$\boldsymbol A$和任意整数$1\le i<n$，有$(\boldsymbol A_{i\cdot})_{\cdot N}=(\boldsymbol A_{\cdot N})_{i\cdot}$

> 借用LADR中的记号，$\boldsymbol A_{i\cdot}$指代$\boldsymbol A$的第$i$行。

还是逐元素分析，因为矩阵$(\boldsymbol A_{i\cdot})_{\cdot N}$和$(\boldsymbol A_{\cdot N})_{i\cdot}$实际上为$1\times m$的行向量，我们讨论第一行即可
$$
((\boldsymbol A_{i\cdot})_{\cdot N})_{1j}=\boldsymbol A_{iq_j}=(\boldsymbol A_{\cdot N})_{ij}=((\boldsymbol A_{\cdot N})_{i\cdot})_{1j}
$$
证明：由引理1、2，我们可做如下整理
$$
\begin{eqnarray}
(\boldsymbol{PSL}+\boldsymbol A)_{\cdot N}&=&(\boldsymbol{PSL})_{\cdot N}+\boldsymbol A_{\cdot N}&=&\boldsymbol{P}((\boldsymbol{SL})_{\cdot N})+\boldsymbol A_{\cdot N}
\end{eqnarray}
$$
设$(\boldsymbol{SL})_{\cdot N}$的第$i$行组成的行向量为$\boldsymbol r_i$，$\boldsymbol P=(p_{ij})$，$\boldsymbol a_{i}=(\boldsymbol A_{\cdot N})_{i\cdot}$，$\boldsymbol r_i=((\boldsymbol {SL})_{\cdot N})_{i\cdot}$；同时，为使$\boldsymbol{P}((\boldsymbol{SL})_{\cdot N})$只涉及$(\boldsymbol{SL})_{NN}$中的行，降低不必要的复杂度，我们令$\boldsymbol P_{\cdot Z}=\boldsymbol O$，从而
$$
(\boldsymbol{P}((\boldsymbol{SL})_{\cdot N})+\boldsymbol A_{\cdot N})_{i\cdot}
=\boldsymbol a_{i}+\sum_{s=1}^np_{is}\boldsymbol r_s
=\boldsymbol a_{i}+\sum_{s\in N}p_{is}\boldsymbol r_s
$$
令$(\boldsymbol{PSL}+\boldsymbol A)_{\cdot N}=\boldsymbol{P}((\boldsymbol{SL})_{\cdot N})+\boldsymbol A_{\cdot N}=\boldsymbol O$，有
$$
(\boldsymbol{P}((\boldsymbol{SL})_{\cdot N})+\boldsymbol A_{\cdot N})_{i\cdot}
=\boldsymbol a_{i}+\sum_{s\in N}p_{is}\boldsymbol r_s=\boldsymbol O
$$
即
$$
\sum_{s\in N}p_{is}\boldsymbol r_s=-\boldsymbol a_{i}
$$
即
$$
(\boldsymbol P_{i\cdot})_{\cdot N}(\boldsymbol {SL})_{NN}=-\boldsymbol a_ia
$$

> 这一步不是那么显然，需要回扣集合下标和$\boldsymbol r_i$的定义，请自行验证。

即
$$
((\boldsymbol {SL})_{NN})^T((\boldsymbol P_{i\cdot})_{\cdot N})^T=-\boldsymbol a_i^T
$$
不难分析，式中矩阵$((\boldsymbol {SL})_{NN})^T$、$((\boldsymbol P_{i\cdot})_{\cdot N})^T$和$-\boldsymbol a_i^T$分别为$m\times m$、$m\times 1$、$m\times 1$矩阵，三者构成标准的非齐次线性方程组的矩阵表示。据定义，$(\boldsymbol {SL})_{NN}$满秩，系数矩阵$((\boldsymbol {SL})_{NN})^T$亦满秩，由此上述方程有解，且可解得
$$
((\boldsymbol P_{i\cdot})_{\cdot N})^T=-(((\boldsymbol {SL})_{NN})^T)^{-1}\boldsymbol a_i^T
$$
即
$$
(\boldsymbol P_{i\cdot})_{\cdot N}=(\boldsymbol P_{\cdot N})_{i\cdot}=-\boldsymbol a_i((\boldsymbol {SL})_{NN})^{-1}
$$
最终可给出$\boldsymbol P$的结构
$$
\boldsymbol P=\operatorname{ComposeC}\left(
\boldsymbol O,
-\boldsymbol A_{\cdot N}((\boldsymbol {SL})_{NN})^{-1}
\right)
$$

### 临门一脚

回到方程的求解。

将我们的$\boldsymbol {PSLX}-\boldsymbol {PSF}=\boldsymbol O$与原方程$\boldsymbol {X}'=\boldsymbol {AX}+\boldsymbol G$相加，有
$$
\boldsymbol {X}'=(\boldsymbol {PSL}+\boldsymbol A)\boldsymbol X+(\boldsymbol G-\boldsymbol {PSF)}
$$
简便起见，不妨设$\hat{\boldsymbol A}=\boldsymbol {PSF+\boldsymbol A}$，$\hat{\boldsymbol G}=\boldsymbol {G}-\boldsymbol {PSF}$，则上式又可写作
$$
\boldsymbol X'=\hat{\boldsymbol A}\boldsymbol X+\hat{\boldsymbol G}
$$
写成“分类聚合”再重新整合的形式
$$
\operatorname{ComposeR}
\begin{pmatrix}
\boldsymbol {X}'_{Z}\\
\boldsymbol {X}'_{N}
\end{pmatrix}
=\operatorname{Compose}
\begin{pmatrix}
\hat{\boldsymbol {A}}_{ZZ}&\hat{\boldsymbol {A}}_{ZN}\\
\hat{\boldsymbol {A}}_{NZ}&\hat{\boldsymbol {A}}_{NN}
\end{pmatrix}
\operatorname{ComposeR}
\begin{pmatrix}
\boldsymbol {X}_{Z}\\
\boldsymbol {X}_{N}
\end{pmatrix}
+
\operatorname{ComposeR}
\begin{pmatrix}
\hat{\boldsymbol {G}}_{Z}\\
\hat{\boldsymbol {G}}_{N}
\end{pmatrix}
$$
根据前文结论展开乘积部分
$$
\operatorname{ComposeR}
\begin{pmatrix}
\boldsymbol {X}'_{Z}\\
\boldsymbol {X}'_{N}
\end{pmatrix}
=\operatorname{ComposeR}
\begin{pmatrix}
\hat{\boldsymbol {A}}_{ZZ}\boldsymbol {X}_{Z}+\hat{\boldsymbol {A}}_{ZN}\boldsymbol {X}_{N}\\
\hat{\boldsymbol {A}}_{NZ}\boldsymbol {X}_{Z}+\hat{\boldsymbol {A}}_{NN}\boldsymbol {X}_{N}
\end{pmatrix}
+
\operatorname{ComposeR}
\begin{pmatrix}
\hat{\boldsymbol {G}}_{Z}\\
\hat{\boldsymbol {G}}_{N}
\end{pmatrix}
$$
加法与$\operatorname{ComposeR}$换序
$$
\operatorname{ComposeR}
\begin{pmatrix}
\boldsymbol {X}'_{Z}\\
\boldsymbol {X}'_{N}
\end{pmatrix}
=\operatorname{ComposeR}
\begin{pmatrix}
\hat{\boldsymbol {A}}_{ZZ}\boldsymbol {X}_{Z}+\hat{\boldsymbol {A}}_{ZN}\boldsymbol {X}_{N}+\hat{\boldsymbol {G}}_{Z}\\
\hat{\boldsymbol {A}}_{NZ}\boldsymbol {X}_{Z}+\hat{\boldsymbol {A}}_{NN}\boldsymbol {X}_{N}+\hat{\boldsymbol {G}}_{N}
\end{pmatrix}
$$
因为对应行相等
$$
\boldsymbol {X}'_{Z}=\hat{\boldsymbol {A}}_{ZZ}\boldsymbol {X}_{Z}+\hat{\boldsymbol {A}}_{ZN}\boldsymbol {X}_{N}+\hat{\boldsymbol {G}}_{Z}\\
\boldsymbol {X}'_{N}=\hat{\boldsymbol {A}}_{NZ}\boldsymbol {X}_{Z}+\hat{\boldsymbol {A}}_{NN}\boldsymbol {X}_{N}+\hat{\boldsymbol {G}}_{N}
$$
前面已证，存在$\boldsymbol P$，使得$\hat{\boldsymbol {A}}_{ZN}=\boldsymbol{O}$，此时第一式可写作
$$
\boldsymbol {X}'_{Z}=\hat{\boldsymbol A}_{ZZ}\boldsymbol X_Z'+\hat{\boldsymbol {G}}_{N}
$$
> 这实际上是将$n$元的原方程简化为了新的$(n-m)$元方程。

此时方程又被重新整理回了最初的形式，这时，要么这一方程本身即可直接求解（特征方程无重根），要么只需进行与上面同样的操作重新整理成类似的形式，直到可以直接求解或化归为一元的形式。

经过若干轮如此的化归后，可求解$\boldsymbol X_Z$，将其代入第二式，并应用$\hat{\boldsymbol{A}_{NN}}=\boldsymbol O$，即可有
$$
\boldsymbol {X}'_{N}=\hat{\boldsymbol {A}}_{NZ}\boldsymbol {X}'_{Z}+\hat{\boldsymbol {G}}_{N}
$$
其中，因为$\boldsymbol X_Z$已求解，等号右侧的函数是确定的，故上式可直接积分处理
$$
\boldsymbol {X}_{N}=\int(\hat{\boldsymbol {A}}_{NZ}\boldsymbol {X}'_{Z}+\hat{\boldsymbol {G}}_{N})\mathrm dt
$$
在以此求解出$\boldsymbol X_N$后，与先前求解的$\boldsymbol X_Z$整合，即得到原方程的通解。

### 初验证

#### 二元一阶方程组的解

为验证此方法的正确性，我们以此求解一下上文中的遗留问题：方程
$$
\begin{pmatrix}
x'\\y'
\end{pmatrix}=
\begin{pmatrix}
a&b\\
c&d
\end{pmatrix}
\begin{pmatrix}
x\\y
\end{pmatrix}
$$
在特征方程有重根时的求解。

在当时，我们曾得出：
$$
\frac{a-d}{2b}x+y=Ce^{\frac{a+d}{2}t}
$$
与不含重根的求解过程类比，上式的地位相当于$\boldsymbol {LX}=\boldsymbol F$，我们不妨等价地写出
$$
\begin{pmatrix}
\frac{a-d}{2b}&1\\
\frac{a-d}{2b}&1
\end{pmatrix}\boldsymbol X=
\begin{pmatrix}
Ce^{\frac{a+d}{2}t}\\
Ce^{\frac{a+d}{2}t}
\end{pmatrix}
$$
> 相当于将原式与自身联立。

其中
$$
\boldsymbol L=\begin{pmatrix}
\frac{a-d}{2b}&1\\
\frac{a-d}{2b}&1
\end{pmatrix}
$$
不难得到该矩阵的秩为1。我们从$\boldsymbol L$中仅可抽取出一个线性无关的列，这里我们不妨选取第二列，即令$N=\{2\}$，$Z=\{1,2\}-N=\{1\}$，继而，确定$\boldsymbol P$的方程$(\boldsymbol{PSL}+\boldsymbol A)_{N}=\boldsymbol{O}$可写作：

> 为避免对$\frac{a-d}{2b}$取值的讨论，这里我们未选择第一列

$$
\left(
\begin{pmatrix}
P_{11}&P_{12}\\
P_{21}&P_{22}
\end{pmatrix}\boldsymbol S\begin{pmatrix}
\frac{a-d}{2b}&1\\
\frac{a-d}{2b}&1\\
\end{pmatrix}
+\begin{pmatrix}
a&b\\
c&d
\end{pmatrix}
\right)_{\cdot N}=\boldsymbol O
$$

仅由$\boldsymbol L$的第一行$\begin{pmatrix}\frac{a-d}{2b}&1\end{pmatrix}$组成的向量组必然线性无关，故我们可以取$R=\{1\}$。

> 没有选取$R=\{2\}$只是为了演示$\boldsymbol S$的取法

为使线性无关行的序号集合与线性无关列的序号集合相同，我们需用$\boldsymbol S$对换矩阵的两行，为此
$$
\boldsymbol S=\begin{pmatrix} 0&1\\1&0 \end{pmatrix}
$$
这样
$$
\begin{eqnarray}
\left(
\begin{pmatrix}
P_{11}&P_{12}\\
P_{21}&P_{22}
\end{pmatrix}\boldsymbol S\begin{pmatrix}
\frac{a-d}{2b}&1\\
\frac{a-d}{2b}&1
\end{pmatrix}
+\begin{pmatrix}
a&b\\
c&d
\end{pmatrix}
\right)_{\cdot N}&=&\left(
\begin{pmatrix}
(P_{11} + P_{12})\frac{a-d}{2b} + a & P_{11} + P_{12} + b\\
(P_{21} + P_{22})\frac{a-d}{2b} + c & P_{21} + P_{22} + d\\
\end{pmatrix}
\right)_{\cdot N}\\
&=&\begin{pmatrix}
P_{11} + P_{12} + b\\
P_{21} + P_{22} + d\\
\end{pmatrix}=\boldsymbol O
\end{eqnarray}
$$
继而
$$
P_{11}+P_{12}=-b\\
P_{21}+P_{22}=-d
$$

我们只需找出满足此约束的任意一个矩阵$\boldsymbol P$即可，显然地，一个简单的取法如下
$$
\boldsymbol P = 
\begin{pmatrix}
0&-b\\ 
0&-d
\end{pmatrix}
$$
这时
$$
\hat{\boldsymbol A} = \boldsymbol{PSL}+\boldsymbol A=
\begin{pmatrix}
0&-b\\
0&-d
\end{pmatrix}
\begin{pmatrix} 0&1\\1&0 \end{pmatrix}
\begin{pmatrix}
\frac{a-d}{2b}&1\\
\frac{a-d}{2b}&1
\end{pmatrix}
+\begin{pmatrix}
a&b\\
c&d
\end{pmatrix}=
\begin{pmatrix}
\frac{a+d}{2} & 0\\
\frac{2bc-ad+d^2}{2b}&0
\end{pmatrix}
$$

$$
\hat{\boldsymbol G}=\boldsymbol{PSF}=\begin{pmatrix}
-bCe^{\frac{a+d}{2}t}\\-dCe^{\frac{a+d}{2}t}
\end{pmatrix}
$$

继而
$$
\boldsymbol {X}'_{Z}=x'=\hat{\boldsymbol {A}}_{ZZ}\boldsymbol {X}_{Z}+\hat{\boldsymbol {G}}_{Z}=\frac{a+d}{2}x-bCe^{\frac{a+d}2t}\\
\boldsymbol {X}'_{N}=y'=\hat{\boldsymbol {A}}_{NZ}\boldsymbol {X}_{Z}+\hat{\boldsymbol {G}}_{N}=\frac{2bc-ad+d^2}{2b}x-dCe^{\frac{a+d}{2}t}
$$
即
$$
x'=\frac{a+d}{2}x-bCe^{\frac{a+d}2t}\\
y'=\frac{2bc-ad+d^2}{2b}x-dCe^{\frac{a+d}{2}t}
$$
求解第一式
$$
x=e^{\frac{a+d}{2}t}(C_1-bCt)
$$
若$a+d=0$，则很容易地可给出
$$
\begin{eqnarray}
y&=&\int\left(\frac{2bc-ad+d^2}{2b}(C_1-bCt)-dC\right)\mathrm dt\\
&=&-\frac{2bc-ad+d^2}{4}Ct^2+\left(\frac{2bc-ad+d^2}{2b}C_1-dC\right)t+C_2\\
&=&-\frac{bc+d^2}{2}Ct^2+\left(\frac{bc+d^2}{b}C_1-dC\right)t+C_2
\end{eqnarray}
$$
考虑到特征值有重根时，$(a-d)^2+4bc=0$，再考虑$a+d=0$，有$d^2+bc=0$，此时
$$
y=C_2-dCt
$$
顺带给出此约束下$x$的简化表达式
$$
x=C_1-bCt
$$
然后，若$a+d\ne0$
$$
\begin{eqnarray}
y&=&\int\left(\frac{2bc-ad+d^2}{2b}(C_1-bCt)e^{\frac{a+d}{2}t}-dCe^{\frac{a+d}{2}t}\right)\mathrm dt\\
&=&\frac{2}{a+d}\left(\frac{2bc-ad+d^2}{2b}C_1-dC\right)e^{\frac{a+d}2t}-\frac{2bc-ad+d^2}{2b}\int bCte^{\frac{a+d}2t}\mathrm dt\\
&=&\frac{2}{a+d}\left(\frac{2bc-ad+d^2}{2b}C_1-dC\right)e^{\frac{a+d}2t}\\
&&-\frac{2bc-ad+d^2}{2b}\frac{2}{a+d}\frac{2bC}{a+d}\int\frac{a+d}2te^{\frac{a+d}2t}\mathrm d\left(\frac{a+d}2t\right)\\
&=&\frac{2}{a+d}\left(\frac{2bc-ad+d^2}{2b}C_1-dC\right)e^{\frac{a+d}2t}-\frac{2bc-ad+d^2}{b(a+d)^2}2C\left(\frac{a+d}2t-1\right)e^{\frac{a+d}2t}\\
&=&\left(\frac{2bc-ad+d^2}{b(a+d)}C_1-\frac{2dC}{a+d}+\frac{2bc-ad+d^2}{(a+d)^2}2C-\frac{2bc-ad+d^2}{a+d}Ct\right)e^{\frac{a+d}2t}+C_2\\
\end{eqnarray}
$$
>  因为$x$和$\boldsymbol L$中“自私”且“先入为主”地规定了一些待定常数的用法，只考虑到自身形式的简洁性，这样，再一涉及$x$、$y$本身具有的“复杂”关系约束，$y$就被置于一个相当尴尬的境地，最终$x$、$y$解的复杂度就大相径庭。但出于篇幅限制（实际上，写到这里时，本部分就已有2.6万字有余），这一问题我们只做如上解释，暂时不进一步讨论。

#### 多出一个常数？

我们注意到，不论$a+d=0$与否，这里都引入了$C$、$C_1$、$C_2$三个待定常数，而且常数$C_2$似乎是“多余”且“反常”的（以往，只有系数矩阵有0特征值时会解中出现单独的常数项）。为此，我们断言，$C_2$的取值固定为0、不依赖于初值条件。

先就$a+d\ne0$的情况讨论。先给出$x$、$y$的最简表达式
$$
x=(D_{11}+D_{12}t)e^{\frac{a+b}2t}\\
y=(D_{21}+D_{22}t)e^{\frac{a+b}2t}+E
$$
其中$D_{ij}$和$E$均为常数。代入原方程组
$$
\left(\frac{a+b}2 D_{11}+D_{12}+\frac{a+b}2 D_{12}t\right)e^{\frac{a+b}2t}=(aD_{11}+bD_{21}+(aD_{12}+bD_{22})t)e^{\frac{a+b}2t}+bE\\
\left(\frac{a+b}2 D_{21}+D_{22}+\frac{a+b}2 D_{22}t\right)e^{\frac{a+b}2t}=(cD_{11}+dD_{21}+(cD_{12}+dD_{22})t)e^{\frac{a+b}2t}+dE\\
$$
结合约束条件$(a-d)^2+4bc=0$化简，即有
$$
bE=dE=0
$$

> 人工化简较为繁琐且易出错，此处可用Wolfram Engine、SageMath等专门的符号运算软件替代之。

鉴于我们在很久之前曾将考虑范围局限在$b\ne0$的情形，故必有$E=0$。

再来看$a+d=0$的情形，此时原方程可写作
$$
\begin{pmatrix}
-bC\\-dC
\end{pmatrix}=
\begin{pmatrix}
a&b\\
c&d
\end{pmatrix}
\begin{pmatrix}
C_1-bCt\\C_2-dCt
\end{pmatrix}=
\begin{pmatrix}
aC_1+bC_2-(abC+bdC)t\\
aC1+dC_2-(bcC+d^2C)t
\end{pmatrix}
$$

由$a+d=0$，有$abC+bdC=(a+d)bC=0$；再考虑到$(a-d)^2+4bc=0$，有$bc+d^2=0$，继而上式可整理为
$$
\begin{pmatrix}
-bC\\-dC
\end{pmatrix}=
\begin{pmatrix}
aC_1+bC_2\\
aC1+dC_2
\end{pmatrix}
$$
> 我们希望，通过一个标量方程的约束，将独立待定常数的数量从3降低到2，但上式是两个标量方程的方程组，故进一步化归仍需要考虑既有的约束条件，以及一些技巧性。一个关键在注意到如下表示：

注意到上式可写作
$$
\begin{pmatrix}
a&b\\
c&d
\end{pmatrix}\begin{pmatrix}
C_1\\C_2
\end{pmatrix}=
-C\begin{pmatrix}
b\\d
\end{pmatrix}
$$
其中
$$
\det\begin{pmatrix}
a&b\\
c&d
\end{pmatrix}=ad-bc=-d^2-bc=-(bc+d^2)=0
$$
故可考虑对上式两侧施加相同的初等行变换，进行化简。这里是二阶矩阵，其行列式为0时，上下两行成比例，考虑到曾假设$b\ne0$，故做如下变换
$$
\begin{pmatrix}
a&b\\
c-a\frac db&d-b\frac db
\end{pmatrix}\begin{pmatrix}
C_1\\C_2
\end{pmatrix}=\begin{pmatrix}
a&b\\
\frac{bc-ad}{b}&0
\end{pmatrix}\begin{pmatrix}
C_1\\C_2
\end{pmatrix}=
-C\begin{pmatrix}
b\\0
\end{pmatrix}
$$
考虑到$ac-bd=0$，上式可写作
$$
\begin{pmatrix}
a&b\\
0&0
\end{pmatrix}\begin{pmatrix}
C_1\\C_2
\end{pmatrix}=
-C\begin{pmatrix}
b\\0
\end{pmatrix}
$$
第二行为恒等式$0=0$，故上式等价于
$$
-\frac1b(aC_1+bC_2)=C
$$
故$C$可由$C_1$、$C_2$与参数$a$、$b$唯一确定，所以$C$不是一个独立常数。

综上，最初求解时多出的独立常数均可消去。

### 解的结构


首先，我们考虑在$\boldsymbol G=\boldsymbol O$的前提下，由此求解方程通解的形式。首先回顾$\boldsymbol F$的定义：
$$
\boldsymbol F=\left(
\begin{matrix}
C_1e^{\alpha_1t}\\C_2e^{\alpha_2t}\\\vdots\\C_ne^{\alpha_nt}
\end{matrix}
\right)
$$
其中$\alpha_i$为$\boldsymbol A$的特征值。

借用前文的定义，展开$\boldsymbol X_N$的计算式
$$
\boldsymbol X_N=-\int(\boldsymbol {PSF})_N\mathrm{d}t
$$
其中，因为$C_i$为任意常数，我们可以忽略掉对其单独施加的诸如乘以常系数的计算。



紧接着我们分析其中可变常数的引入与确定。

上述步骤中，我们对$1\times m$阶矩阵$\hat{\boldsymbol G}_N$进行了一次不定积分，并由此得到了$m$个可变常数（来自积分常数）；接下来对所得$(n-m)$元方程的的处理中，我们要么得到若干个

## “正统”思路

尽管经由上面的方法，我们得出了方程$\boldsymbol X'=\boldsymbol{AX}+\boldsymbol G$的一个解法，但是，我们却没有据此得到其解的结构。而且，该解法中各种错综复杂的变换也让方程解结构的求解变得几乎不可能。为此，我们必须考虑一个新的方法。

再看一遍我们的方程$\boldsymbol X'=\boldsymbol{AX}+\boldsymbol G$，其实很难不有将方程的解写为$\boldsymbol X=e^{\boldsymbol At}\displaystyle\int e^{-\boldsymbol At}\boldsymbol G\mathrm dt$的冲动。但是，其中出现的矩阵次幂$e^{\boldsymbol A t}$又该如何计算呢？

### 矩阵指数

#### 定义

其实对单纯的矩阵（尤指方阵）次幂我们可能并不陌生，即使先前未曾听闻，我们也很借助自然指数函数的Taylor展开容易理解其定义：
$$
e^{\boldsymbol M}=\sum_{k=0}^\infty\frac{\boldsymbol M^k}{k!}
$$
特殊地，我们规定$e^{\boldsymbol O}=\boldsymbol I$，以补全上述定义的缺漏。

> 将两部分定义整合，可得到统一的定义
> $$
> e^{\boldsymbol M}=\boldsymbol I+\sum_{k=1}^\infty\frac{\boldsymbol M^k}{k!}
> $$

#### 收敛性

先来考察它的收敛性：

在实数域中证明$e^x$的Taylor级数$\sum_{k=0}^\infty\frac{x^k}{k!}$收敛时，我们解题的关键是从指数函数$x^k$的增长速度远远小于阶乘$k!$。这里，我们也有$k$次幂的形式$\boldsymbol M^k$，而且，我们有理由断言，如果将其每个元素（或其上界）整理成指数式的形式，我们似乎可以很容易地证明原命题。

我们相信，可以借助相当宽松的放缩，可以给出$\boldsymbol M^k$的各个元素的指数形式上界。

先试着“放缩”$\boldsymbol M^k$。这里将$\boldsymbol M$替换为一个形状与$\boldsymbol M$相同，所有元素均等于$\boldsymbol M$中绝对值最大值的一个矩阵，来最大化乘积中各元素的取值，以此实现放缩：

> 注意此处$|(\boldsymbol M^k)_{ij}|$是元素$(\boldsymbol M^k)_{ij}$这一元素的绝对值，而非行列式的记号。

$$
\begin{eqnarray}
|(\boldsymbol M^{k})_{ij}|&=&|(\boldsymbol M^{k-1}\cdot\boldsymbol M)_{ij}|\\
&=&\left|\sum_{s=1}^n(\boldsymbol M^{k-1})_{is}\boldsymbol M_{sj}\right|\\
&\le&\sum_{s=1}^n|(\boldsymbol M^{k-1})_{is}||\boldsymbol M_{sj}|&\text{(应用一次绝对值不等式)}\\
&\le&n\cdot\max_{1\le s\le n}|(\boldsymbol M^{k-1})_{is}|\cdot\max_{1\le s\le n}|\boldsymbol M_{sj}|&\text{(实质上是以最大值替换原矩阵所涉及元素)}\\
&\le&n\cdot\max_{1\le p,q\le n}|(\boldsymbol M^{k-1})_{pq}|\cdot\max_{1\le p,q\le n}|\boldsymbol M_{pq}|&\text{(再进一步替换为整个矩阵中的最大值)}\\
&\le&n^2\cdot\max_{1\le p,q\le n}|(\boldsymbol M^{k-2})_{pq}|\left(\max_{1\le p,q\le n}|\boldsymbol M_{pq}|\right)^2~~~~~~&\text{(依照上一步反复迭代)}\\
&\le&\cdots\\
&\le&\max_{1\le p,q\le n}|(\boldsymbol M^{0})_{pq}|\left(n\max_{1\le p,q\le n}|\boldsymbol M_{pq}|\right)^k\\
&=&\left(n\max_{1\le p,q\le n}|\boldsymbol M_{pq}|\right)^k&\text(单位矩阵最大元素为1)
\end{eqnarray}
$$
其中$n\displaystyle\max_{1\le s\le n}|\boldsymbol M_{sj}|$为与$k$无关的常数。继而原命题可化为复数域下$e^x$的Taylor级数收敛性的证明，不再展开。

也可以用归纳法重写上述步骤，为此我们分两步进行：

第一步，求全部元素为相同数值的矩阵的幂
$$
\boldsymbol P^r=\begin{pmatrix}
M&\cdots&M\\
\vdots&&\vdots\\
M&\cdots&M
\end{pmatrix}^r
$$
对低阶、低次的情形经过试探性的计算可猜测
$$
\boldsymbol P^r=\begin{pmatrix}
M^rn^{r-1}&\cdots&M^rn^{r-1}\\
\vdots&&\vdots\\
M^rn^{r-1}&\cdots&M^rn^{r-1}
\end{pmatrix}
$$
易验证其对$r=1$的情形成立。我们计算
$$
\boldsymbol P^{r+1}=\begin{pmatrix}
M^rn^{r-1}&\cdots&M^rn^{r-1}\\
\vdots&&\vdots\\
M^rn^{r-1}&\cdots&M^rn^{r-1}
\end{pmatrix}\begin{pmatrix}
M&\cdots&M\\
\vdots&&\vdots\\
M&\cdots&M
\end{pmatrix}
$$
其中对任意$i$、$j$，$(P^{r+1})_{ij}$均有相同的表达式
$$
(P^{r+1})_{ij}=\sum_{i=1}^nM^rn^{r-1}\cdot M=M^{r+1}n^r
$$
上述猜测得证。

第二步，令$M=\displaystyle\max_{1\le i,j\le n}|\boldsymbol M_{ij}|$，我们证明，对任意矩阵$\boldsymbol M$和$r\in\N_+$，$\boldsymbol M^r$任一元素的绝对值均不大于$\boldsymbol P^r$的对应元素，即对任意$i$、$j$：
$$
|(\boldsymbol M^r)_{ij}|\le(\boldsymbol P^r)_{ij}
$$
由标量$M$的定义，$r=1$时，上式必然成立。然后，对$r\ge1$给出递推如下：
$$
\begin{eqnarray}
|(\boldsymbol M^{r+1})_{ij}|&=&\left|\sum_{s=1}^n(\boldsymbol M^{r})_{is}\boldsymbol M_{sj}\right|\\
&\le&\sum_{s=1}^n\left|(\boldsymbol M^{r})_{is}\right|\left|\boldsymbol M_{sj}\right|\\
&\le&\sum_{s=1}^n(\boldsymbol P^r)_{is} M\\
&=&\sum_{s=1}^nM^rn^{r-1} M\\
&=&M^{r+1}n^r=(\boldsymbol P^{r+1})_{ij}
\end{eqnarray}
$$
归纳可证原猜测。继而又有
$$
|(\boldsymbol M^{k})_{ij}|\le n^{k-1}M^k=\frac1n\left(n\max_{1\le i,j\le n}|\boldsymbol M_{ij}|\right)^k
$$
> 因为这里我们对关于$\boldsymbol M^1$和$\boldsymbol M^0$的一步递推的处理与第一种方法略有出入，所以得到的上界要略紧一点点。不过核心思想大同小异，结果也是殊途同归。

### 对角化？标准型！

既然收敛已成已知，接下来要怎么计算呢？

我们知道，可对角化的矩阵$\boldsymbol M$可如下分解：
$$
\boldsymbol M=\boldsymbol B^{-1}\boldsymbol D\boldsymbol B
$$
其中$\boldsymbol B$为满秩矩阵，$\boldsymbol D$为对角矩阵。并且，我们也知道，这样的矩阵的幂可如下表示
$$
\boldsymbol M^n=\boldsymbol B^{-1}\boldsymbol D^n\boldsymbol B
$$
其中，$\boldsymbol D^n$很容易求值，故$\boldsymbol M^n$的值也可被顺利表出。继而，我们实际上有
$$
e^{\boldsymbol M}=\boldsymbol B^{-1}e^{\boldsymbol D}\boldsymbol B
$$
但是，因为我们无法保证系数矩阵$\boldsymbol A$可对角化，所以实际上我们无法直接采用上述思路。

没有办法了吗？天无绝人之路。《Linear Algebra Done Right》的（几乎）最后讲述了一种Jordan标准型，可以让我们将任意复方阵$\boldsymbol M$如下分解：
$$
\boldsymbol M=\boldsymbol B^{-1}\boldsymbol J\boldsymbol B
$$
其中$\boldsymbol J$为Jordan标准型，$\boldsymbol B$为对应的Jordan basis，前者具有如下“分块对角矩阵”的形式：
$$
\boldsymbol J=\begin{pmatrix}
\boldsymbol J_1&&\\
&\ddots&\\
&&\boldsymbol J_m
\end{pmatrix}
$$
其中$\boldsymbol J_i$称为Jordan Block，其对角线元素为$\boldsymbol M$的某个特征值$\lambda_i$，对角线正上方恒为1，为行列数与$\lambda_i$的代数重数相同的方阵。每个Jordan Block对应的特征值互不相同。其结构如下：
$$
\boldsymbol J_i=\begin{pmatrix}
\lambda_i&1&&&\\
&\lambda_i&1&&\\
&&\ddots&\ddots\\
&&&\lambda_i&1\\
&&&&\lambda_i
\end{pmatrix}
$$
不难证明
$$
e^{\boldsymbol M}=\boldsymbol B^{-1}e^{\boldsymbol J}\boldsymbol B
$$
而
$$
\boldsymbol J^n=\begin{pmatrix}
\boldsymbol J_1^n&&\\
&\ddots&\\
&&\boldsymbol J_m^n
\end{pmatrix}
$$
所以实际上又不难证明
$$
e^{\boldsymbol M}=\boldsymbol B^{-1}\begin{pmatrix}
e^{\boldsymbol J_1}&&\\
&\ddots&\\
&&e^{\boldsymbol J_m}
\end{pmatrix}\boldsymbol B=
\boldsymbol B^{-1}\begin{pmatrix}
\displaystyle\sum_{k=0}^\infty \frac{\boldsymbol J_1^k}{k!}&&\\
&\ddots&\\
&&\displaystyle\sum_{k=0}^\infty \frac{\boldsymbol J_m^k}{k!}
\end{pmatrix}\boldsymbol B
$$
这样，如果我们可以求出Jordan Block的幂次，实际上就可以求出$e^{\boldsymbol M}$。

因为$J_i$可视为由两个具有“明显特征”的矩阵的和：
$$
\boldsymbol J_i=\begin{pmatrix}
\lambda_i&1&&&\\
&\lambda_i&1&&\\
&&\ddots&\ddots\\
&&&\lambda_i&1\\
&&&&\lambda_i
\end{pmatrix}=\begin{pmatrix}
\lambda_i&&&&\\
&\lambda_i&&&\\
&&\ddots\\
&&&\lambda_i&\\
&&&&\lambda_i
\end{pmatrix}+\begin{pmatrix}
0&1&&&\\
&0&1&&\\
&&\ddots&\ddots\\
&&&0&1\\
&&&&0
\end{pmatrix}
$$
为方便计算，我们记分解出的对角阵为$\boldsymbol D_i$，另一个仅含0、1的矩阵为$\boldsymbol U$

因为二项式定理对矩阵也成立
$$
\begin{eqnarray}
\boldsymbol J_i^n&=&\left(\boldsymbol D_i+\boldsymbol U\right)^n=\sum_{k=0}^{n}C_n^i\boldsymbol D^k\boldsymbol U^{n-k}
\end{eqnarray}
$$
为推进计算，这里我们需要了解右侧矩阵（对角线上方含1）的行为。在三、四阶的情形下尝试将其与单位矩阵反复相乘，可以发现，在相乘的过程中，单位矩阵对角线上的元素会被一步步地移向右上角，直到被完全“移出”矩阵的范围：
$$
\begin{pmatrix}
1&&&\\
&1&&\\
&&1&\\
&&&1
\end{pmatrix}
\overset{乘以\boldsymbol U}{\longrightarrow}\begin{pmatrix}
&1&&\\
&&1&\\
&&&1\\
&&&
\end{pmatrix}
\overset{乘以\boldsymbol U}{\longrightarrow}\begin{pmatrix}
&&1&\\
&&&1\\
&&&\\
&&&
\end{pmatrix}
\overset{乘以\boldsymbol U}{\longrightarrow}\begin{pmatrix}
&&&1\\
&&&\\
&&&\\
&&&
\end{pmatrix}
\overset{乘以\boldsymbol U}{\longrightarrow}\boldsymbol 0
$$
这也可通过简单的矩阵乘法的逐元素计算证明：

设$\boldsymbol J_i$的行列数为$m_i$，则
$$
(a_{ij})\boldsymbol U=\left(\sum_{k=1}^{m_i}a_{ik}u_{kj}\right)=\left(\begin{cases}a_{i(j-1)}&j\ne1\\0&j=1\end{cases}\right)
$$
由这一行为，我们也可得到，$n\ge m_i$时，$\boldsymbol U^k=\boldsymbol D_i^{n-k}\boldsymbol U^k=\boldsymbol 0$，继而
$$
\boldsymbol J_i^n=\sum_{k=0}^{m_i-1}C_n^k\boldsymbol D_i^{n-k}\boldsymbol U^k
$$
因为$k$不同时，$\boldsymbol U^k$为$\boldsymbol D_i^{n-k}$施加的“偏移”不同，故对不同$k$，$\boldsymbol D_i^{n-k}\boldsymbol U_k$非零元素所占据的位置不同，这为相加提供了便利。不难通过简单计算得到
$$
\boldsymbol J_i^n=\begin{pmatrix}
C_n^0\lambda_i^n&C_n^1\lambda_i^{n-1}&C_n^2\lambda_i^{n-2}&\cdots&C_n^{m_i}\lambda_i^{n-m_i}\\
&C_n^0\lambda_i^n&C_n^1\lambda_i^{n-1}&\cdots&C_n^{m_i-1}\lambda_i^{n-m_i+1}\\
&&\ddots&\ddots&\vdots\\
&&&C_n^0\lambda_i^n&C_n^1\lambda_i^{n-1}\\
&&&&C_n^0\lambda_i^n
\end{pmatrix}
$$
需要注意，这里出现的组合数在$n$充分大时虽然有效，但在$n$较小时，却会出现在传统的排列数中未定义的情况（如$C_3^5$）。这里，我们需要规定整数$m<0$时$C_n^m=0$，才能保证此等式与真实的计算结果相等。这一定义在其它很多领域（比如广义二项式定理的表示）也有广泛的应用，此处不再展开说明。

由上式
$$
\begin{eqnarray}
e^{\boldsymbol J_i}&=&\sum_{n=0}^\infty\frac1{n!}\begin{pmatrix}
C_n^0\lambda_i^n&C_n^1\lambda_i^{n-1}&C_n^2\lambda_i^{n-2}&\cdots&C_n^{m_i}\lambda_i^{n-m_i}\\
&C_n^0\lambda_i^n&C_n^1\lambda_i^{n-1}&\cdots&C_n^{m_i-1}\lambda_i^{n-m_i+1}\\
&&\ddots&\ddots&\vdots\\
&&&C_n^0\lambda_i^n&C_n^1\lambda_i^{n-1}\\
&&&&C_n^0\lambda_i^n
\end{pmatrix}\\
&=&\Tiny{\begin{pmatrix}
\displaystyle\sum_{n=0}^\infty\frac{\lambda_i^n}{0!(n-0)!}&\displaystyle\sum_{n=1}^\infty\frac{\lambda_i^{n-1}}{1!(n-1)!}&\displaystyle\sum_{n=2}^\infty\frac{\lambda_i^{n-2}}{2!(n-2)!}&\cdots&\displaystyle\sum_{n=m_i}^\infty\frac{\lambda_i^{n-m_i}}{m_i!(n-m_i)!}\\
&\displaystyle\sum_{n=0}^\infty\frac{\lambda_i^n}{0!(n-0)!}&\displaystyle\sum_{n=1}^\infty`\frac{\lambda_i^{n-1}}{1!(n-1)!}&\cdots&\displaystyle\sum_{n=m_i-1}^\infty\frac{\lambda_i^{n-m_i+1}}{(m_i-1)!(n-m_i+1)!}\\
&&\ddots&\ddots&\vdots\\
&&&\displaystyle\sum_{n=0}^\infty\frac{\lambda_i^n}{0!(n-0)!}&\displaystyle\sum_{n=1}^\infty\frac{\lambda_i^{n-1}}{1!(n-1)!}\\
&&&&\displaystyle\sum_{n=0}^\infty\frac{\lambda_i^n}{0!(n-0)!}
\end{pmatrix}}\\
&=&\begin{pmatrix}
\displaystyle\frac{e^{\lambda_i}}{0!}&\displaystyle\frac{e^{\lambda_i}}{1!}&\displaystyle\frac{e^{\lambda_i}}{2!}&\displaystyle\cdots&\displaystyle\frac{e^{\lambda_i}}{m_i!}\\
&\displaystyle\frac{e^{\lambda_i}}{0!}&\displaystyle\frac{e^{\lambda_i}}{1!}&\displaystyle\cdots&\displaystyle\frac{e^{\lambda_i}}{(m_i-1)!}\\
&&\displaystyle\ddots&\displaystyle\ddots&\displaystyle\vdots\\
&&&\displaystyle\frac{e^{\lambda_i}}{0!}&\displaystyle\frac{e^{\lambda_i}}{1!}\\
&&&&\displaystyle\frac{e^{\lambda_i}}{0!}
\end{pmatrix}\\
\end{eqnarray}
$$
把上面的结果放到分块对角矩阵$\boldsymbol J$的幂当中，不难求解，继而，我们可以用$\boldsymbol B^{-1}e^{\boldsymbol J}\boldsymbol B$的形式表示以任意矩阵$\boldsymbol M$作为幂次的指数。

再考虑我们实际的问题$e^{\boldsymbol At}$。乍看似只需要将上面的$\boldsymbol M$简单替换成$\boldsymbol At$就可以了，但实际上，因为两者的Jordan basis（$\boldsymbol B$）往往不相同，这种替换实际上行不通。同时，可预料到，求解含符号$t$的矩阵$\boldsymbol At$的Jordan basis的复杂度要远远高过单纯地处理常数矩阵，所以我们不如先“借用”$\boldsymbol A$的Jordan basis$\boldsymbol B$，从而借此表示$e^{\boldsymbol At}$：
$$
e^{\boldsymbol At}=\sum_{n=0}^\infty\frac{(\boldsymbol At)^n}{n!}=\sum_{i=0}^\infty\frac{\boldsymbol B^{-1}\boldsymbol J^n\boldsymbol Bt^n}{n!}=\boldsymbol B^{-1}\left(\sum_{i=0}^\infty\frac{(\boldsymbol Jt)^n}{n!}\right)\boldsymbol B
$$
因为$\boldsymbol Jt$不再是Jordan标准型（Jordan block中对角线上方是$t$而不是1），我们不能直接沿用上面的公式给出其$n$次幂的表达式。不过，有了先前的经验，我们不难再从头推导：

我们设$\require{enclose}\enclose{horizontalstrike}{\boldsymbol J}_i=\boldsymbol J_it$，$\require{enclose}\enclose{horizontalstrike}{\boldsymbol U}=\boldsymbol Ut$，$\require{enclose}\enclose{horizontalstrike}{\boldsymbol D}_i=\operatorname{diag}(\alpha_it,\cdots,\alpha_it)$，其中$\alpha_i$是$\boldsymbol A$的一个重数为$m_i$的特征值，则

> 记号沿用自5月13日的草稿，其中横线来自“t”当中的横线

$$
\require{enclose}
\enclose{horizontalstrike}{\boldsymbol J}_i^n=\sum_{k=0}^nC_n^k\enclose{horizontalstrike}{\boldsymbol U}^k+\enclose{horizontalstrike}{\boldsymbol D}_i^{n-k}
$$

相较于$\boldsymbol U$单纯“偏移”元素位置的行为，$\enclose{horizontalstrike}{\boldsymbol U}$的行为是在偏移元素的基础上，添加了一步乘以$t$的操作：
$$
\begin{pmatrix}
1&&&\\
&1&&\\
&&1&\\
&&&1
\end{pmatrix}
\overset{乘以\enclose{horizontalstrike}{\boldsymbol U}}{\longrightarrow}\begin{pmatrix}
&t&&\\
&&t&\\
&&&t\\
&&&
\end{pmatrix}
\overset{乘以\enclose{horizontalstrike}{\boldsymbol U}}{\longrightarrow}\begin{pmatrix}
&&t^2&\\
&&&t^2\\
&&&\\
&&&
\end{pmatrix}
\overset{乘以\enclose{horizontalstrike}{\boldsymbol U}}{\longrightarrow}\begin{pmatrix}
&&&t^3\\
&&&\\
&&&\\
&&&
\end{pmatrix}
\overset{乘以\enclose{horizontalstrike}{\boldsymbol U}}{\longrightarrow}\boldsymbol 0
$$
虽然从这一步有些读者可能就可以猜测出$e^{\enclose{horizontalstrike}{\boldsymbol J}}$的形式了，但为稳妥起见，我们还是仿照前文按部就班地重新推导一遍：
$$
\require{enclose}
\begin{eqnarray}
\enclose{horizontalstrike}{\boldsymbol J}^n&=&\sum_{k=0}^nC_n^k\enclose{horizontalstrike}{\boldsymbol U}^k+\enclose{horizontalstrike}{\boldsymbol D}^{n-k}
&=&\begin{pmatrix}
C_n^0\alpha_i^{n}&C_n^1\alpha_i^{n}&C_n^2\alpha_i^{n}&\cdots&C_n^{m_i}\alpha_i^{n}\\
&C_n^0\alpha_i^{n}&C_n^1\alpha_i^{n}&\cdots&C_n^{m_i-1}\alpha_i^{n}\\
&&\ddots&\ddots&\vdots\\
&&&C_n^0\alpha_i^{n}&C_n^1\alpha_i^{n}\\
&&&&C_n^0\alpha_i^{n}
\end{pmatrix}
\end{eqnarray}
$$
令人惊喜的是，经过这样一个更改，矩阵似乎甚至变得比先前更规整了。然后我们做以下计算：
$$
\begin{eqnarray}
e^{\enclose{horizontalstrike}{\boldsymbol J}}&=&\sum_{n=0}^\infty\frac1{n!}\begin{pmatrix}
C_n^0\alpha_i^nt^n&\cdots&C_n^{m_i}\alpha_i^{n-m_i}t^n\\
&\ddots&\vdots\\
&&C_n^0\alpha_i^nt^n
\end{pmatrix}\\
&=&\begin{pmatrix}
\displaystyle\sum_{n=0}^\infty\frac{\alpha_i^nt^n}{0!(n-0)!}&\cdots&\displaystyle\sum_{n=m_i}^\infty\frac{\alpha_i^{n-m_i}t^n}{m_i!(n-m_i)!}\\
&\ddots&\vdots\\
&&\displaystyle\sum_{n=0}^\infty\frac{\alpha_i^nt^n}{0!(n-0)!}
\end{pmatrix}\\
&=&\begin{pmatrix}
\displaystyle\sum_{n=0}^\infty\frac{\alpha_i^nt^n}{0!n!}&\cdots&t^{m_i}\displaystyle\sum_{n=0}^\infty\frac{\alpha_i^{n}t^n}{m_i!n!}\\
&\ddots&\vdots\\
&&\displaystyle\sum_{n=0}^\infty\frac{\alpha_i^nt^n}{0!n!}
\end{pmatrix}\\
&=&\begin{pmatrix}
\frac{e^{\alpha_it}}{0!}&\cdots&\frac{t^{m_i}}{m_i!}e^{\alpha_it}\\
&\ddots&\vdots\\
&&\frac{e^{\alpha_it}}{0!}
\end{pmatrix}\\
\end{eqnarray}
$$
即
$$
e^{\boldsymbol J_it}=\begin{pmatrix}
e^{\alpha_it}&te^{\alpha_it}&\cdots&\frac{t^{m_i}}{m_i!}e^{\alpha_it}\\
&\ddots&\ddots&\vdots\\
&&\ddots&te^{\alpha_it}\\
&&&e^{\alpha^it}
\end{pmatrix}
$$
或者说
$$
(e^{\boldsymbol J_it})_{pq}=\begin{cases}
0&q<p\\
\frac{t^{q-p}}{(q-p)!}e^{\alpha_it}&q\ge p
\end{cases}
$$
设$\beta_1,\cdots,\beta_l$为$\boldsymbol A$的$l$个互异的特征值，其中$\beta_i$的重数为$w_i$，从而不难写出任意矩阵$\boldsymbol At$的指数表示
$$
e^{\boldsymbol At}=\boldsymbol B^{-1}
\begin{pmatrix}
\begin{pmatrix}
e^{\beta_1t}&\cdots&\frac{t^{w_1}}{w_1!}e^{\beta_1t}\\
&\ddots&\vdots\\
&&e^{\beta_1t}
\end{pmatrix}\\
&\ddots\\
&&
\begin{pmatrix}
e^{\beta_lt}&\cdots&\frac{t^{w_l}}{w_l!}e^{\beta_lt}\\
&\ddots&\vdots\\
&&e^{\beta_lt}
\end{pmatrix}
\end{pmatrix}\boldsymbol B
$$
继而可通过
$$
\boldsymbol X=e^{\boldsymbol At}\displaystyle\int e^{-\boldsymbol At}\boldsymbol G\mathrm dt
$$
给出原方程的解……吗？真的可行吗，又为什么可行呢？

### 求解合理性证明

参照标量方程的验证：
$$
\begin{eqnarray}
x'&=&\left(e^{\alpha t}\int e^{-\alpha t} g\mathrm dt\right)'\\
&=&\left(e^{\alpha t}\right)'\int e^{-\alpha t} g\mathrm dt+e^{\alpha t}\left(\int e^{-\alpha t} g\mathrm dt\right)'\\
&=&\alpha e^{\alpha t}\int e^{-\alpha t} g\mathrm dt+e^{\alpha t}e^{-\alpha t} g\\
&=&\alpha x+g
\end{eqnarray}
$$
这里我们用到了以下几处关键性质
$$
(fg)'=f'g+fg'
$$

$$
\left(e^{\alpha t}\right)'=\alpha e^{\alpha t}
$$

$$
e^{\alpha t}\cdot e^{-\alpha t}=e^{\alpha t+(-\alpha)t}=e^0=1
$$

但是其在矩阵指数的推广是不显然的，由此，我们需要证明三个与之对应的引理

**引理1**：对于可微函数组成的$m\times s$矩阵$\boldsymbol A=(f_{ij})$和$s\times n$矩阵$\boldsymbol B=(g_{ij})$，有$(\boldsymbol{AB})'=\boldsymbol A'\boldsymbol B+\boldsymbol A\boldsymbol B'$

逐元素分析
$$
\begin{eqnarray}
(\boldsymbol A'\boldsymbol B+\boldsymbol A\boldsymbol B')_{ij}&=&(\boldsymbol A'\boldsymbol B)_{ij}+(\boldsymbol A\boldsymbol B')_{ij}\\
&=&\sum_{k=1}^sf_{ik}'g_{kj}+\sum_{k=1}^sf_{ik}g_{kj}'\\
&=&\sum_{k=1}^s(f_{ik}'g_{kj}+f_{ik}g_{kj}')\\
&=&\sum_{k=1}^s(f_{ik}g_{kj})'\\
&=&(\boldsymbol{AB})'
\end{eqnarray}
$$
待证两式两端矩阵大小一致，元素分别相等，故两者相同。

**引理2**：对于任意复方阵$\boldsymbol A$，有$\left(e^{\boldsymbol At}\right)'=\boldsymbol Ae^{\boldsymbol t}$

> 这一命题使用Jordan Form证明其实还没有直接对原矩阵证明来得方便
>
> $\boldsymbol A=\boldsymbol O$的情形是trivial的，此处不做展开，下一个引理亦然。

回顾$e$的矩阵次幂的定义，有
$$
\left(e^{\boldsymbol At}\right)'
=\sum_{k=0}^\infty\left(\frac{\boldsymbol A^kt^k}{k!}\right)'
=\sum_{k=1}^\infty\frac{\boldsymbol A^kt^{k-1}}{(k-1)!}
=\sum_{k=0}^{\infty}\frac{\boldsymbol A^{k+1}t^k}{k!}
=\boldsymbol A\sum_{k=0}^{\infty}\frac{\boldsymbol A^{k}t^k}{k!}
=\boldsymbol Ae^{\boldsymbol At}
$$
**引理3**：对于任意复方阵$\boldsymbol A$，有$e^{\boldsymbol At}e^{-\boldsymbol At}=\boldsymbol I$
$$
e^{\boldsymbol A}e^{\boldsymbol B}
=\left(\sum_{k=0}^\infty\frac{\boldsymbol A^kt^k}{k!}\right)\left(\sum_{k=0}^\infty\frac{(-\boldsymbol A)^kt^k}{k!}\right)
$$
对右侧仿照Cauchy乘积的形式展开
$$
e^{\boldsymbol A}e^{\boldsymbol B}
=\sum_{k=0}^\infty\sum_{l=0}^{k}\frac{\boldsymbol A^lt^l}{l!}\frac{(-1)^{k-l}\boldsymbol A^{k-l}t^{k-l}}{(k-l)!}
=\sum_{k=0}^\infty\sum_{l=0}^{k}\frac{\boldsymbol A^l(-\boldsymbol A)^{k-l}}{l!(k-l)!}t^k
$$
注意到最右侧的分母与组合数$C_{k}^l=\frac{k!}{k!(k-l)!}$的分母形似，且式中有$\boldsymbol A^k(-\boldsymbol A)^{l-k}$这种幂次“此消彼长”的结构，不免联想到二项式定理。实际上可进行如下配凑
$$
e^{\boldsymbol At}e^{-\boldsymbol At}
=\boldsymbol I+\sum_{k=1}^\infty\frac{t^k}{k!}\sum_{l=0}^{k}C_{k}^l\boldsymbol A^l(-\boldsymbol A)^{k-l}
=\boldsymbol I+\sum_{k=1}^\infty\frac{(\boldsymbol A-\boldsymbol A)^kt^k}{k!}
=\boldsymbol I+\sum_{k=1}^\infty\frac{\boldsymbol O^k}{k!}
=\boldsymbol I
$$

> 这里应用二项式定理是基于事实$\boldsymbol A(-\boldsymbol A)=(-\boldsymbol A)\boldsymbol A$，不能随意推广，如$(\boldsymbol A+\boldsymbol B)^2=\boldsymbol A^2+2\boldsymbol {AB}+\boldsymbol B^2$通常不成立。

原命题得证。

综合上述引理，解合理性的验证便水到渠成：
$$
\begin{eqnarray}
\boldsymbol X' &=& \left(e^{\boldsymbol At}\displaystyle\int e^{-\boldsymbol At}\boldsymbol G\mathrm dt\right)'\\
&=&\left(e^{\boldsymbol At}\right)'\int e^{-\boldsymbol At}\boldsymbol G\mathrm dt+e^{\boldsymbol At}e^{-\boldsymbol At}\boldsymbol G\\
&=&\boldsymbol Ae^{\boldsymbol At}\displaystyle\int e^{-\boldsymbol At}\boldsymbol G\mathrm dt+e^{\boldsymbol O}\boldsymbol G\\
&=&\boldsymbol {AX}+\boldsymbol G
\end{eqnarray}
$$

### 解的结构

